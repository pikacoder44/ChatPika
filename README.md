## ✨ ChatPika — Next.js AI Chat App

A full‑stack AI chat app built with Next.js 15 (App Router), React 19, Tailwind CSS v4, Clerk auth, MongoDB/Mongoose, and Google’s Gemini API. It supports streaming AI responses, persistent chat history, and a modern, responsive UI with dark mode.

---

### 🚀 Features
- **AI chat with streaming** via `gemini-1.5-flash` (`/api/ai/chat`)
- **Persistent chats** (create, list, fetch by id) stored in MongoDB
- **Auto chat titles** generated by AI after first exchange
- **Authentication** with Clerk middleware protection on API routes
- **Modern UI/UX** with Tailwind v4, shadcn-inspired components, Radix primitives
- **Dark mode** using `next-themes`
- **Responsive layout** and sidebar chat list

---

### 🧱 Tech Stack
- **Framework**: Next.js 15 (App Router), React 19
- **Styling**: Tailwind CSS v4
- **Auth**: Clerk (`@clerk/nextjs`)
- **Database**: MongoDB with Mongoose
- **AI**: `@google/generative-ai` (Gemini 1.5 Flash)
- **UI/Utilities**: Radix UI, `class-variance-authority`, `clsx`, `react-markdown`, `react-syntax-highlighter`, `swr`
- **Build**: Turbopack dev/build scripts

---

### 🗂️ Project Structure (high level)
- `app/`
  - `layout.tsx` — Root providers (`ClerkProvider`, `ThemeProvider`, nav, progress)
  - `page.tsx` — Landing page (hero, features, stats, CTA, footer)
  - `about/page.tsx`, `contact/page.tsx`, `pricing/page.tsx` — Static pages
  - `chat/`
    - `[chatId]/layout.tsx` — Sidebar + session wrapper
    - `[chatId]/page.tsx` — Chat UI, streams responses, saves history
  - `api/`
    - `ai/chat/route.ts` — POST: stream AI response; saves to chat when signed in
    - `ai/generatetitle/route.tsx` — POST: generate and persist a short chat title
    - `chats/route.ts` — POST: create chat; GET: list user’s chats
    - `chats/[chatId]/route.ts` — GET: fetch single chat if owned
- `components/`
  - `Navbar.tsx`, `Footer.tsx`, `ThemeToggle.tsx`
  - `ChatWindow.tsx`, `WelcomeChat.tsx`, `TypingIndicator.tsx`
  - `app-sidebar.tsx`, `ui/` (button, dialog, dropdown, input, scroll-area, sheet, sidebar, skeleton, tooltip, etc.)
  - `NavigationProgress.tsx`, `SessionWatcher.tsx`, `SignInReq.tsx`
- `lib/`
  - `db.ts` — Mongo connection with connection caching
  - `models/Chat.ts`, `models/User.ts` — Mongoose models
  - `utils.ts` — helpers (if used)
- `middleware.ts` — Clerk middleware enforcing auth on pages and `/api` routes
- `next.config.mjs`, `tsconfig.json`, `postcss.config.mjs`, `eslint.config.mjs`
- `public/` — icons and assets

---

### 🔌 API Overview
- `POST /api/ai/chat`
  - Body: `{ message: string, chatId?: string }`
  - Returns: streamed text; if authenticated and `chatId` provided, appends user message then assistant reply to that chat
- `POST /api/ai/generatetitle`
  - Body: `{ messages: Array<{role, content}>, chatId: string }`
  - Uses AI to produce a concise title and updates the chat
- `POST /api/chats`
  - Auth required; creates a new chat with optional title
- `GET /api/chats`
  - Auth required; lists user’s chats (most recent first)
- `GET /api/chats/[chatId]`
  - Auth + ownership required; returns a single chat’s messages

---

### 🗃️ Data Model
- `User`
  - `clerkId: string (unique)`, `email: string`, `createdAt: Date`
- `Chat`
  - `userId: string (Clerk id)`, `title: string`, `messages: { role: "user"|"assistant", content: string, timestamp: Date }[]`, `createdAt: Date`

---

### 🧰 Getting Started

#### 1) Prerequisites
- Node.js 18+ (20+ recommended)
- MongoDB connection string
- Clerk account + app (publishable + secret keys)
- Google Gemini API key

#### 2) Install
```bash
npm i
```

#### 3) Environment
Create `.env.local` in the project root:
```bash
# AI
GEMINI_API_KEY=your_gemini_api_key

# Database
MONGODB_URI=your_mongodb_connection_string

# Clerk
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_xxx
CLERK_SECRET_KEY=sk_test_xxx

# (optional if using custom routes)
# NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
# NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
```

#### 4) Run (Dev)
```bash
npm run dev
# http://localhost:3000
```

#### 5) Build & Start (Prod)
```bash
npm run build
npm start
```

---

### 🖥️ How It Works (Flow)
- Client sends `POST /api/ai/chat` with the prompt and current `chatId` (if signed in).
- Server validates env keys, ensures DB connection, and resolves the Clerk user.
- If authenticated and `chatId` is valid, the user message is appended to `Chat.messages`.
- The server calls Gemini (`generateContentStream`) and streams chunks back via `ReadableStream`.
- Client accumulates chunks into the assistant message; once complete, the assistant reply is saved to the same chat.
- After the first exchange in a chat, the client triggers `/api/ai/generatetitle` to produce a short title and updates the chat.

---

### 🎨 Styling/Theming Notes
- Tailwind v4 with design tokens in `app/globals.css`
- Dark mode via `next-themes` (`attribute="class"`)
- Reusable components in `components/ui/*` with Radix primitives and shadcn patterns

---

### 🔒 Auth & Middleware
- `middleware.ts` applies Clerk to all routes including `/api`, excluding static assets and Next internals.
- Server routes use `currentUser()` to enforce access and scope resources per `clerkId`.

---

### 🧪 Scripts
- `dev` — start dev server (Turbopack)
- `build` — production build (Turbopack)
- `start` — run production server
- `lint` — run ESLint

---

### ☁️ Deployment
- Works well on Vercel or any Node host supporting Next.js 15
- Set environment variables (`GEMINI_API_KEY`, `MONGODB_URI`, Clerk keys) in hosting provider

---

### 📄 License
MIT